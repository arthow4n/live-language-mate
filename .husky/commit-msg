#!/bin/sh

message_file="$1"

if [ -n "$IS_CLAUDE_CODE" ]; then
    failed=0

    # Check subject line
    if ! head -n 1 "$message_file" | grep -Eq "^\(Claude Code\) "; then
        echo "[POLICY] Claude Code must begin its commit message with '(Claude Code) '"
        failed=1
    fi

    # Check for required footer
    if ! grep -Eq "^Co-Authored-By: Claude <noreply@anthropic\.com>$" "$message_file"; then
        echo "[POLICY] Claude Code commits must include footer:"
        echo "Co-Authored-By: Claude <noreply@anthropic.com>"
        failed=1
    fi

    if [ "$failed" -ne 0 ]; then
        exit 1
    fi
fi
